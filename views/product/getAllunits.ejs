<!DOCTYPE html>
<html lang="en">
  <head>
    <title>All Units</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <script>
      function showForm(type, unit = null) {
        document.getElementById("unitTable").style.display = "none";
        document.getElementById("createForm").style.display = "none";
        document.getElementById("editForm").style.display = "none";

        if (type === "create") {
          document.getElementById("createForm").style.display = "block";
        } else if (type === "edit" && unit) {
          const parsedUnit = JSON.parse(decodeURIComponent(unit));
          document.getElementById("editId").value = parsedUnit.id;
          document.getElementById("editOrderUnit").value = parsedUnit.orderUnit;
          document.getElementById("editPackingUnit").value =
            parsedUnit.packingUnit;
          document.getElementById("editWeight").value = parsedUnit.weight;
          document.getElementById("editNote").value = parsedUnit.noteForMe;

          // âœ… Set correct action URL
          document.getElementById(
            "editUnitForm"
          ).action = `/unite/edit/${parsedUnit.id}?_method=PUT`;

          document.getElementById("editForm").style.display = "block";
        }
      }

      function goBack() {
        document.getElementById("createForm").style.display = "none";
        document.getElementById("editForm").style.display = "none";
        document.getElementById("unitTable").style.display = "block";
      }
    </script>
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="text-center mb-4">All Product Units</h1>

      <div class="d-flex justify-content-end mb-3">
        <button class="btn btn-primary" onclick="showForm('create')">
          Create Unit
        </button>
      </div>

      <div id="unitTable">
        <% if (units && units.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Order Unit</th>
                <th>Packing Unit</th>
                <th>Weight</th>
                <th>Note</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% units.forEach(unit => { %>
              <tr>
                <td><%= unit.id %></td>
                <td><%= unit.orderUnit %></td>
                <td><%= unit.packingUnit %></td>
                <td><%= unit.weight %></td>
                <td><%= unit.noteForMe %></td>
                <td>
                  <button
                    class="btn btn-warning btn-sm"
                    onclick='showForm("edit", "<%= encodeURIComponent(JSON.stringify(unit)) %>")'
                  >
                    Edit
                  </button>
                  <form
                    action="/unite/delete/<%= unit.id %>?_method=DELETE"
                    method="POST"
                  >
                    <button
                      type="submit"
                      class="btn btn-danger btn-sm"
                      onclick="return confirm('Are you sure you want to delete this unit?');"
                    >
                      Delete
                    </button>
                  </form>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
        <% } else { %>
        <p class="text-center text-danger">No units found.</p>
        <% } %>
      </div>

      <!-- Create Form -->
      <div id="createForm" style="display: none">
        <h2>Create New Product Unit</h2>
        <form action="/unite/create-unit" method="POST">
          <label>Order Unit:</label>
          <input
            type="text"
            name="orderUnit"
            required
            class="form-control"
          /><br />
          <label>Packing Unit:</label>
          <input type="text" name="packingUnit" class="form-control" /><br />
          <label>Weight:</label>
          <input
            type="number"
            name="weight"
            step="0.01"
            class="form-control"
          /><br />
          <label>Note:</label>
          <textarea name="noteForMe" class="form-control"></textarea><br />
          <button type="submit" class="btn btn-success">Create</button>
          <button type="button" class="btn btn-secondary" onclick="goBack()">
            Back
          </button>
        </form>
      </div>

      <!-- Edit Form -->
      <div id="editForm" style="display: none">
        <h2>Edit Product Unit</h2>
        <form id="editUnitForm" action="" method="POST">
          <input type="hidden" name="_method" value="PUT" />
          <input type="hidden" name="id" id="editId" />
          <label>Order Unit:</label>
          <input
            type="text"
            name="orderUnit"
            id="editOrderUnit"
            required
            class="form-control"
          /><br />
          <label>Packing Unit:</label>
          <input
            type="text"
            name="packingUnit"
            id="editPackingUnit"
            class="form-control"
          /><br />
          <label>Weight:</label>
          <input
            type="number"
            name="weight"
            id="editWeight"
            step="0.01"
            class="form-control"
          /><br />
          <label>Note:</label>
          <textarea
            name="noteForMe"
            id="editNote"
            class="form-control"
          ></textarea
          ><br />
          <button type="submit" class="btn btn-warning">Update</button>
          <button type="button" class="btn btn-secondary" onclick="goBack()">
            Back
          </button>
        </form>
      </div>
    </div>
  </body>
</html>
